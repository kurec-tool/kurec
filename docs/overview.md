# 録画予約システム 主要要件

> 詳細な設計・フローは `システム全体設計` ドキュメントを参照してください。

---

## 🎯 本番運用で重視すべき要件

| 要件         | 説明                                                                               |
|--------------|------------------------------------------------------------------------------------|
| **高可用性** | ジョブ失敗時に自動再試行、DLQ で永久障害を切り分けし、システム全体の継続稼働を保証。        |
| **スケーラビリティ** | 番組データ量の増大やワーカー台数増加に耐えうる、水平分散型アーキテクチャ。              |
| **型安全性** | `#[event]` マクロ＋`Event` トレイトで、メッセージ型とストリーム名をコンパイル時に整合。   |
| **一貫性**   | `StreamDef` によるストリーム定義の一元管理、`setup_all_streams` で起動時プロビジョニング。   |
| **テスト容易性** | マクロの `trybuild`、JetStream E2E、in-memory テストを組み合わせたテスト戦略。          |
| **可観測性** | ミドルウェア層でエラー分類・ロギング・メトリクスを一元化し、運用時の可視化を実現。         |
| **保守性**   | `StreamWorker` による共通化されたワーカーパターンで、コードの重複を排除し保守性を向上。    |

---

## 📌 参照ドキュメント

- **システム全体設計** (High-Level アーキテクチャ／フロー／各コンポーネント)
- **shared-core / shared-macros** (型・トレイト定義・コード生成)
- **infra/jetstream** (JetStream 接続・設定・Publisher/Subscriber 実装)
- **app/workers** (`WorkerBuilder`＋ミドルウェア利用例)
- **テスト戦略** (`trybuild`, `testcontainers`, in-memory)

---
